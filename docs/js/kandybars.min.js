/*
 * The MIT License (MIT)
 *
 * Copyright (c) 2017 Karl STEIN
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_template=__webpack_require__(2),_patterns=__webpack_require__(4),_patterns2=_interopRequireDefault(_patterns),_lib=__webpack_require__(1),_lib2=_interopRequireDefault(_lib),reservedWords=["abstract","arguments","boolean","break","byte","case","catch","char","class","const","continue","debugger","default","delete","do","double","else","enum","eval","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","let","void","volatile","while","with","yield"],Template={},Kandybars={helpers:{},create:function(e,t){return console.warn("deprecated method Kandybars.create(), use Kandybars.registerTemplate() instead"),this.registerTemplate(e,t)},exists:function(e){return console.warn("deprecated method Kandybars.exists(), use Kandybars.isTemplate() instead"),this.isTemplate(e)},fetchBlockArguments:function(e){var t=[];"string"==typeof e&&e.length&&(e=e.trim());for(var n=e.split(" "),r=0;r<n.length;r+=1){var a=n[r][0],i=n[r].slice(-1);if('"'!==a&&"'"!==a||a===i&&"\\"+i!==n[r].slice(-2))t.push(n[r]);else for(var l=[n[r]],o=r+1;o<n.length;o+=1)if(i=n[o].slice(-1),l.push(n[o]),i===a&&"\\"+i!==n[o].slice(-2)){r=o,t.push(l.join(" "));break}}return t},getTemplate:function(e){return Template[e]},getTemplatesLogic:function(){return Template},isHelper:function(e){return this.helpers.hasOwnProperty(e)&&"function"==typeof this.helpers[e]},isTemplate:function(e){return Template.hasOwnProperty(e)&&Template[e]instanceof _template.Template},load:function(e,t){var n=this;"string"==typeof e?this.loadFile(e,t):e instanceof Array&&function(){for(var r=e.length,a=0;a<e.length;a+=1)n.loadFile(e[a],function(e){r-=e?0:1,(e||0===r)&&"function"==typeof t&&t.call(n,e)})}()},loadFile:function loadFile(url,callback){var _this2=this,fileType=url.substr(url.lastIndexOf(".")+1),req=new XMLHttpRequest;switch(req.onerror=function(e){"function"==typeof callback&&callback.call(_this2,new Error("Cannot load file : "+url,e.target.status))},req.onreadystatechange=function(){if(4===req.readyState)if(200===req.status){switch(fileType){case"js":eval(req.responseText);break;case"html":case"hbml":case"kbml":case"tpl":_this2.parseTemplates(req.responseText)}"function"==typeof callback&&callback.call(_this2,null)}else"function"==typeof callback&&callback.call(_this2,new Error("Cannot load file : "+url))},req.open("GET",url,!0),fileType){case"html":case"hbml":case"kbml":case"tpl":req.overrideMimeType("text/plain")}req.send(null)},parseBlockArguments:function(e,t,n){for(var r=this.fetchBlockArguments(e),a=0;a<r.length;a+=1){var i=this.parseValue(r[a],t,n);/^(["'])[^\1]+?\1$/.test(i)&&(i=i.substring(1,i.length-1)),r[a]=i}return r},parseBlockParams:function(e,t,n){var r={};if("string"==typeof e)for(var a=e.trim().split(" "),i=0;i<a.length;i+=1){var l=a[i].trim().split("=",2),o=l[0].trim();if("this"===o){var s=this.parseValue(l[1],t,n);"object"===(void 0===s?"undefined":_typeof(s))&&null!==s&&(r=_lib2.default.extend({},s,r))}else r[o]=this.parseValue(l[1],t,n)}return r},parseHelperArguments:function(e,t,n){return console.warn("deprecated method Kandybars.parseHelperArguments(), use Kandybars.parseBlockArguments() instead"),this.parseBlockArguments(e,t,n)},parseHelperParams:function(e,t,n){return console.warn("deprecated method Kandybars.parseHelperParams(), use Kandybars.parseBlockParams() instead"),this.parseBlockParams(e,t,n)},parseTemplates:function(e){for(var t={length:0},n=e.match(_patterns2.default.templateRegExp),r=0;r<n.length;r+=1){var a=n[r],i=a.match(/name=(["'])([^"]+)\1/),l=i&&i[2];if("string"!=typeof l||0===l.length)throw new SyntaxError('Missing "name" attribute for <template>');if("length"===l)throw new SyntaxError('Value of "name" attribute for <template> cannot be "length"');var o=a.replace(_patterns2.default.templateTagsRegExp,"");t[l]=this.registerTemplate(l,o),t.length+=1}return t},parseValue:function(e,t,n){if("string"==typeof e){if(/^(['"])[^\1]+?\1$/.test(e))return e.substr(1,e.length-2);if(-1!==["+","-","*","/"].indexOf(e))return e;if(/^true$/i.test(e))return!0;if(/^false$/i.test(e))return!1;if(/^[+-]?[0-9]*[.,][0-9]+$/.test(e))return parseFloat(e.replace(",","."));if(/^[+-]?(?:[0-9]+|Infinity)$/.test(e))return parseInt(e);if(-1!==reservedWords.indexOf(e))return e;_patterns2.default.contextPathRegExp.test(e)&&"string"==typeof(e=this.resolvePath(e,t,n))&&(e='"'+e.replace(/"/g,'\\"')+'"')}return e},registerHelper:function(e,t){if("string"!=typeof e||0===e.length)throw new Error("Helper name must be a string");if(!/^[a-zA-Z_]+[a-zA-Z0-9_]*$/.test(e))throw new Error("Helper name is not valid: "+e);if("function"!=typeof t)throw new Error("Helper callback must be a function");this.isHelper(e)&&console.warn('Helper "'+e+'" has been defined already'),this.helpers[e]=t},registerTemplate:function(e,t){return Template[e]=new _template.Template(e,t)},render:function(e,t,n){if(!this.isTemplate(e))throw new Error('Template "'+e+'" does not exist');return this.getTemplate(e).createInstance(t,n).render(n)},renderHTML:function(e,t,n){var r="tpl_"+Date.now();return new _template.Template(r,e).createInstance(t,n).render(n)},replaceAll:function(e,t,n){if(t)for(var r in t)t.hasOwnProperty(r)&&"function"==typeof t[r]&&(t[r]=t[r].call(t));return n||(n={}),e=this.replaceComments(e),e=this.replaceConditions(e,t,n),e=this.replaceBlocks(e,t,n),e=this.replacePartials(e,t,n),e=this.replaceWith(e,t,n),e=this.replaceEvals(e,t,n),e=this.replaceHelpers(e,t,n),e=this.replaceVariables(e,t,n),e=this.replaceAttributes(e)},replaceAttributes:function(e){return e.replace(/(?:disabled|checked|selected)=["'](?:false)?["']/gim,"")},replaceBlocks:function(e,t,n){var r=this;return e.replace(_patterns2.default.eachBlockRegExp,function(e,a,i){var l=r.resolvePath(a,t,n),o="",s={},u="";if(null!==l&&void 0!==l)if(l instanceof Array||"number"==typeof l.length)for(var p=0;p<l.length;p+=1)s=l[p],"object"===(void 0===s?"undefined":_typeof(s))&&(s["@index"]=p),u=i.replace("{{@index}}",p),u=u.replace("@index",String(p)),o+=r.replaceAll(u,s,{special:{"@index":p},parent:{data:t,parent:n}});else if("object"===(void 0===l?"undefined":_typeof(l)))for(var c in l)l.hasOwnProperty(c)&&(s=l[c],"object"===(void 0===s?"undefined":_typeof(s))&&(s["@key"]=c),u=i.replace("{{@key}}",c),u=u.replace("@key",c),o+=r.replaceAll(u,s,{special:{"@key":c},parent:{data:t,parent:n}}));return o})},replaceComments:function(e){return e.replace(_patterns2.default.commentBlockRegExp,"")},replaceConditions:function(e,t,n){for(var r=this;-1!==e.indexOf("{{#if");)e=e.replace(_patterns2.default.conditionBlockRegExp,function(e,a,i){var l="",o=i.split("{{else}}");i=o[0];var s=o[1];return a=a.replace(_patterns2.default.blockArgumentRegExp,function(e,a){return r.parseValue(a,t,n)}),_lib2.default.evalCondition(a)?"string"==typeof i&&(l=r.replaceAll(i,t,{parent:{data:t,parent:n}})):"string"==typeof s&&(l=r.replaceAll(s,t,{parent:{data:t,parent:n}})),l});return e},replaceEvals:function(e,t,n){var r=this;return e.replace(_patterns2.default.evalBlockRegExp,function(e,a){a=a.replace(_patterns2.default.blockArgumentRegExp,function(e,a){return r.parseValue(a,t,n)});var i=r.parseBlockArguments(a,t,n);return _lib2.default.evalCondition(i.join(" "))})},replaceHelpers:function(e,t,n){var r=this;return e.replace(_patterns2.default.helperBlockRegExp,function(e,a,i){if(i=r.parseBlockArguments(i,t,n),!r.isHelper(a))throw new Error('Helper "'+a+'" does not exist');var l=r.helpers[a];return"function"==typeof l&&(l=l.apply(t,i)),void 0!==l&&null!==l?l:""})},replacePartials:function(e,t,n){var r=this;return e.replace(_patterns2.default.partialBlockRegExp,function(e,a,i){i=r.parseBlockParams(i,t,n);var l=_lib2.default.extend({},t,i),o=r.render(a,l,{html:!0,parent:_lib2.default.extend({},(n||{}).parent,{instance:r}),partial:!0});return null!==o?o:""})},replaceVariables:function(e,t,n){var r=this;return e.replace(_patterns2.default.variableBlockRegExp,function(e,a){var i=r.resolvePath(a,t,n),l=void 0===i?"undefined":_typeof(i);if(null!==i&&void 0!==i&&"string"!==l&&"number"!==l&&"boolean"!==l)if("object"===l)i=i.hasOwnProperty("toString")?i.toString():i;else{if("function"!==l)throw new Error('Cannot replace variable "'+a+'" of type "'+l+'"');var o=n&&n.parent?n.parent:{};i=i(t,o.data,o)}return null!==i?i:""})},replaceVars:function(e,t,n){return console.warn("deprecated method Kandybars.replaceVars(), use Kandybars.replaceVariables() instead"),this.replaceVariables(e,t,n)},replaceWith:function(e,t,n){var r=this;return e.replace(_patterns2.default.withBlockRegExp,function(e,a,i){var l=r.resolvePath(a,t,n),o="";return null!==l&&void 0!==l&&"object"===(void 0===l?"undefined":_typeof(l))&&(o=r.replaceAll(i,l,{parent:{data:t,parent:n}})),o})},resolvePath:function(e,t,n){if(n=n||{},"string"==typeof e&&null!==t&&void 0!==t){if(n.special&&n.special.hasOwnProperty(e))return n.special[e];if(!_patterns2.default.contextPathRegExp.test(e))return null;if("this"===e)return t;var r=t;if(0===e.indexOf("../")?(n.parent?n instanceof _template.TemplateInstance?r=n.parent.parent.data||{}:n.parent.data&&(r=n.parent.data||{}):r={},e=e.substring(3)):0===e.indexOf("this.")&&(r=t,e=e.substring(5)),null!==r)for(var a=e.split("."),i=a.length,l=0;l<i;l+=1){var o=a[l];if(null===r||void 0===r)break;if(!o.length||"object"!==(void 0===r?"undefined":_typeof(r))){r=null;break}if(-1!==o.indexOf("[")){var s=o.indexOf("["),u=0,p=o.substr(0,s);if(r.hasOwnProperty(p))do{if(s=o.indexOf("[",u),u=o.indexOf("]",s),-1!==s&&-1!==u){var c=o.substr(s+1,u-(s+1));r=(r[p],Array,r[p][c])}}while(-1!==s)}else r=r.hasOwnProperty(o)?r[o]:null;null!==r&&"function"==typeof r&&(r=r.call(t))}return r}return null}};exports.default=Kandybars,void 0!==window&&void 0===window.Kandybars&&(window.Kandybars=Kandybars,window.Kandybars.Template=_template.Template,window.Kandybars.TemplateInstance=_template.TemplateInstance,window.Template=Template)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default={evalCondition:function evalCondition(condition){var __kbRes=void 0;return"string"==typeof condition&&condition.length>0&&(condition=condition.replace(/[\r\n]/g,"")),eval("__kbRes = ( "+condition+" );"),__kbRes},extend:function(){for(var e=1;e<arguments.length;e+=1)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.TemplateInstance=t.Template=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3),s=n(0),u=r(s),p=n(1),c=r(p),f=0,d={},h=function(){function e(t,n){if(a(this,e),"string"!=typeof t||t.length<1)throw new Error("Template name must be a string");if(!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(t))throw new Error('Template name "'+t+'" is not valid');if("string"!=typeof n)throw new Error("Template source must be a string");this._events={},this._helpers={},this._source=n,this.name=t,this.observer=new o.Observer(this),this.rendered=null}return l(e,[{key:"createInstance",value:function(e,t){return new v(this,e,t)}},{key:"events",value:function(e){if(null!==e&&"object"===(void 0===e?"undefined":i(e)))for(var t in e)e.hasOwnProperty(t)&&(this._events[t]=e[t])}},{key:"getEvents",value:function(){return this._events}},{key:"getHelpers",value:function(){return this._helpers}},{key:"getName",value:function(){return this.name}},{key:"getSource",value:function(){return this._source}},{key:"helpers",value:function(e){if(null!==e&&"object"===(void 0===e?"undefined":i(e)))for(var t in e)e.hasOwnProperty(t)&&(this._helpers[t]=e[t])}},{key:"onRendered",value:function(e){this.observer.attach("rendered",e)}}]),e}();t.Template=h;var v=t.TemplateInstance=function(){function e(t,n,r){a(this,e),f+=1,r=c.default.extend({events:{},helpers:{},parent:null,partial:!1,rendered:null},r),this.children=[],this.data=n,this.options=r,this.observer=new o.Observer(this),this.template=t,this.id="kbti_"+f,this.parent=r.parent,r.partial&&(d[this.id]=this),this.parent&&this.parent.instance instanceof e&&this.parent.instance.getChildren().push(this)}return l(e,[{key:"_rendered",value:function(){"function"==typeof this.options.rendered?this.options.rendered.call(this,this.compiled,this.getContext()):"function"==typeof this.getTemplate().rendered&&this.getTemplate().rendered.call(this,this.compiled,this.getContext()),this.observer.notify("rendered",this.compiled,this.getContext())}},{key:"attachEvent",value:function(e,t,n){var r=this;if("function"==typeof t)for(var a=e.split(","),i=0;i<a.length;i+=1){e=a[i];var l=e.split(" ",2),o=l[0],s=l[1],u=s&&n.filter(s);u&&1===u.length&&(n=u,s=null),function(e,a){n.on(e,a,function(e){t.call(r.getContext(),e,n,r)})}(o,s)}}},{key:"attachEvents",value:function(e,t){for(var n in e)e.hasOwnProperty(n)&&this.attachEvent(n,e[n],t)}},{key:"getChildren",value:function(){return this.children}},{key:"getContext",value:function(){return c.default.extend({},this.data,this.template._helpers)}},{key:"getEvents",value:function(){return c.default.extend({},this.getTemplate().getEvents(),this.options.events)}},{key:"getHelpers",value:function(){return c.default.extend({},this.getTemplate().getHelpers(),this.options.helpers)}},{key:"getId",value:function(){return this.id}},{key:"getParent",value:function(){return this.parent&&this.parent.instance}},{key:"getTemplate",value:function(){return this.template}},{key:"hasChildren",value:function(){return this.children.length>0}},{key:"isPartial",value:function(){return!0===this.options.partial}},{key:"render",value:function(e){e=c.default.extend({events:{},helpers:{},html:!1,parent:null,rendered:null},e);var t=this.getContext(),n=this.getTemplate(),r=n.getSource(),a=u.default.replaceAll(r,t,e);if(this.isPartial()){var i=this.getId(),l=a.indexOf("<"),o=a.indexOf(">",l);a=-1===l||-1===o?'<div data-partial-id="'+i+'">'+a+"</div>":a.substr(0,o)+' data-partial-id="'+i+'"'+a.substr(o)}else if(!e.html&&"undefined"!=typeof jQuery){a=jQuery(a),e.target&&jQuery(e.target).html(a);var s=function(){var e=jQuery(this),t=e.attr("data-partial-id"),n=d[t];n.compiled=jQuery(this),n.attachEvents(n.getEvents(),e),n._rendered()};a.filter("[data-partial-id]").each(s),a.find("[data-partial-id]").each(s),this.attachEvents(this.getEvents(),a)}return this.compiled=a,e.html||this._rendered(),a}}]),e}()},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.Observer=function(){function e(t){r(this,e),this.context=t,this.events={}}return a(e,[{key:"attach",value:function(e,t){if("string"!=typeof e)throw new TypeError("Event is not a string");if("function"!=typeof t)throw new TypeError("Callback is not a function");this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"detach",value:function(e,t){if(this.events[e])if("function"==typeof t){var n=this.events[e].indexOf(t);this.events[e].splice(n,1)}else delete this.events[e]}},{key:"setContext",value:function(e){this.context=e}},{key:"notify",value:function(){var e=Array.prototype.slice.call(arguments);if(e.length<1)throw new TypeError("Wrong number of arguments");var t=e.shift();if("string"!=typeof t)throw new TypeError("Event is not a string");if(this.events[t]instanceof Array)for(var n=0;n<this.events[t].length;n+=1)this.events[t][n].apply(this.context,e)}}]),e}()}])})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={blockArgumentRegExp:/\b((?:this\.|\.\.\/)?[a-zA-Z_$][a-zA-Z0-9_$]*(?:\.[a-zA-Z0-9_$]+)*)\b(?!["'])/g,commentBlockRegExp:/{{![^}]+?}}/g,conditionBlockRegExp:/{{#if ([^}]+)}}((?:(?!{{#if)[\s\S])*?){{\/if}}/g,contextPathRegExp:/^(?:this\.|\.\.\/)?[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\[[a-zA-Z0-9_]*])?|\.[a-zA-Z_][a-zA-Z0-9_]*)*$/,eachBlockRegExp:/{{#each ((?:this\.|\.\.\/)?[a-zA-Z0-9_]+(?:\.[a-zA-Z0-9_]+)*)}}([\s\S]*?){{\/each}}/g,evalBlockRegExp:/{{eval ([^}]+)}}/g,helperBlockRegExp:/{{([a-zA-Z0-9_]+) ([^}]+)}}/g,partialBlockRegExp:/{{> *([^ }]+)( +[^}]+)*}}/g,templateRegExp:/<template[^>]*>([\s\S]*?)<\/template>/g,templateTagsRegExp:/<template[^>]*>|<\/template>/g,variableBlockRegExp:/{{{?((?:this\.|\.\.\/)?[a-zA-Z0-9_]+(?:\.[a-zA-Z0-9_]+)*)}}}?/g,withBlockRegExp:/{{#with ((?:this\.|\.\.\/)?[a-zA-Z0-9_]+(?:\.[a-zA-Z0-9_]+)*)}}([\s\S]*?){{\/with}}/g}}])});
